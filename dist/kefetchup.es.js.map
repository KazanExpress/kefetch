{"version":3,"file":"kefetchup.es.js","sources":["../src/errors.ts","../src/defaultFetch.ts","../src/genericClient.ts","../src/index.ts"],"sourcesContent":["export class ResponseException<T = Response> extends Error {\n  constructor(\n    message: string,\n    public status: ResponseErrors,\n    public data?: T\n  ) {\n    super(message)/* istanbul ignore next: because stupid typescript */;\n    Object.setPrototypeOf(this, ResponseException.prototype);\n    this.name = 'ResponseException';\n  }\n\n  toString() {\n    return this.name + ': ' + this.message;\n  }\n}\n\nexport enum ResponseErrors {\n  BadRequest = 400,\n  Unauthorized = 401,\n  PaymentRequired = 402,\n  Forbidden = 403,\n  NotFound = 404,\n  MethodNotAllowed = 405,\n  NotAcceptable = 406,\n  ProxyAuthenticationRequired = 407,\n  RequestTimeout = 408,\n  Conflict = 409,\n  Gone = 410,\n  LengthRequired = 411,\n  InvalidMedia = 415,\n  'I\\'m a teapot' = 418,\n  Unprocessable = 422,\n  TooManyRequests = 429,\n  ServerError = 500,\n  NotImplemented = 501,\n  BadGateway = 502,\n  ServiceUnavailable = 503,\n  GatewayTimeout = 504,\n  UnknownError = -1\n}\n","import { ResponseErrors } from './errors';\n\n/**\n * Default fetch handler\n *\n * @export\n * @param {string} url\n * @param {RequestInit} [options]\n * @returns {Promise<Response>}\n */\nexport function defaultFetch(url: string, options?: RequestInit): Promise<Response> {\n  return Promise.resolve(new Response(\n    JSON.stringify(defaultFetchHandlerResponseBody(url, options)),\n    defaultFetchHandlerResponseOptions\n  ));\n}\n\nexport const defaultFetchHandlerResponseBody = (url: string, options?: RequestInit) => ({\n  error: 'Default-fetch-handler response.',\n\n  // Emulate a behaviour of JSON.stringify that does not enumerate undefined properties\n  ...(url === undefined ? {} : { to: url }),\n  ...(options === undefined ? {} : { options })\n});\n\nexport const defaultFetchHandlerResponseOptions = {\n  status: ResponseErrors[`I'm a teapot`],\n  statusText: '`fetch` missing in `window`'\n};\n","import { defaultFetch } from './defaultFetch';\nimport { ResponseException, ResponseErrors } from './errors';\n\n/**\n * Generic API client with default request.\n * Inherit from this class to create a custom extendable api client.\n *\n * Can be instantiated on its own for simple singular requests.\n */\nexport class GenericAPIClient {\n  public fetchHandler = window.fetch ? window.fetch.bind(window) : defaultFetch;\n\n  /**\n   * Creates an instance of GenericAPIClient.\n   * @param {string} [baseURL=''] a base url to prepend to all request urls except for the ones with root urls\n   * @param {RequestInit} [clientConfig={}] a default config for requests\n   */\n  constructor(\n    public readonly baseURL: string = '',\n    public readonly clientConfig: RequestInit = {}\n  ) {}\n\n  /**\n   * Makes requests using request factory and resolves config merge conflicts.\n   *\n   * @private\n   */\n  private request(\n    url: string,\n    fetchConfig: RequestInit,\n    overrideDefaultConfig: boolean = false\n  ): Promise<any> {\n    if (!url.match(/^(\\w+:)?\\/\\//)) {\n      url = this.baseURL ? new URL(url, this.baseURL).href : url;\n    }\n\n    return this.requestFactory(\n      url,\n      overrideDefaultConfig ? fetchConfig : { ...this.clientConfig, ...fetchConfig },\n      this.fetchHandler\n    );\n  }\n\n  /**\n   * Processes the response before allowing to return its value from request function.\n   * Override this function to provide custom response interception.\n   * Keep in mind that this function does not have to return a promise.\n   *\n   * @protected\n   * @param {Response} response the response returned from fetchHandler\n   * @returns {*} default: the same response\n   * @memberof GenericAPIClient\n   */\n  protected responseHandler(response: Response): any {\n    if (response.ok) {\n      return response;\n    } else {\n      throw new ResponseException(GenericAPIClient.handleStatus(response.status), response.status, response);\n    }\n  }\n\n  /**\n   * Processes the request error before allowing to throw it upstack.\n   * Override this function to provide custom response error handling.\n   * Return value instead of throwing for soft error handling.\n   *\n   * @protected\n   * @param e the error catched from the request promise\n   * @memberof GenericAPIClient\n   */\n  protected errorHandler(e): any {\n    if (e instanceof ResponseException)\n      throw e;\n    else\n      throw new ResponseException('Unkown Error: ', ResponseErrors.UnknownError, e);\n  }\n\n  /**\n   * A general request factory function.\n   * Calls request and error handlers, can be used for pre-processing the url and request config before sending.\n   * Override for a completely custom request & response handling behaviour.\n   *\n   * @protected\n   * @param url a url string that would be passed into the request function\n   * @param config a request config that would be passed into the request function\n   * @param requestFunction\n   */\n  protected requestFactory(\n    url: string,\n    config: RequestInit,\n    requestFunction: (url: string, config?: RequestInit) => Promise<Response>\n  ): Promise<any> {\n    return new Promise<Response>((resolve, _) => requestFunction(url, config)\n      .then(r => resolve(this.responseHandler(r)))\n      .catch(this.errorHandler)\n    );\n  }\n\n  /**\n   * Request method alias factory.\n   * Used to quickly produce alias function for class' decendants.\n   * Override at your own risk.\n   *\n   * @protected\n   * @param {string} method HTTP method (GET, PUT, POST, etc) to alias\n   * @returns an alias function for request\n   * @memberof GenericAPIClient\n   */\n  protected alias(method: string) {\n    return function (this: GenericAPIClient,\n      url: string,\n      fetchConfig: RequestInit = this.clientConfig,\n      overrideDefaultConfig?: boolean\n    ): ReturnType<typeof this['request']> {\n      fetchConfig = fetchConfig;\n      fetchConfig.method = method ? method.toUpperCase() : (fetchConfig.method || 'GET').toUpperCase();\n      return this.request(url, fetchConfig, overrideDefaultConfig);\n    }\n  }\n\n  public readonly get = this.alias('get');\n  public readonly put = this.alias('put');\n  public readonly post = this.alias('post');\n  public readonly patch = this.alias('patch');\n  public readonly delete = this.alias('delete');\n\n  /**\n   * Retrieves response status string in a readable format from a status number\n   *\n   * @param {number|string} [status=-1] Response status (200, 404, 500, etc)\n   * @returns {string} a status literal for logging\n   */\n  public static handleStatus(status?: number): string;\n\n  /**\n   * Retrieves response status number from a readable PascalCase string\n   *\n   * @param {number|string} [status=-1] Response status (\"NotFound\", \"OK\", \"Unknown\", etc)\n   * @returns {number} a status number for requests\n   */\n  public static handleStatus(status: string): number;\n\n  public static handleStatus(status: number | string = -1) {\n    return ResponseErrors[status] || ResponseErrors[-1];\n  }\n}\n","import { GenericAPIClient } from './genericClient';\n\nexport * from './genericClient';\nexport * from './errors';\n\n/**\n * @inheritdoc\n */\nexport class JsonAPIClient extends GenericAPIClient {\n  /**\n   * @inheritdoc\n   */\n  responseHandler(resp: Response): Promise<unknown> {\n    return resp.json();\n  }\n}\n\n/**\n * @inheritdoc\n */\nexport class TextAPIClient extends GenericAPIClient {\n  /**\n   * @inheritdoc\n   */\n  responseHandler(resp: Response) {\n    return resp.text();\n  }\n}\n"],"names":[],"mappings":"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"}