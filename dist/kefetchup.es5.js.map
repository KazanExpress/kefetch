{"version":3,"file":"kefetchup.es5.js","sources":["../src/generic-client.ts","../src/clients.ts"],"sourcesContent":["export type APIClientHandlers = {\n  fetchHandler: (url: string, options?: RequestInit) => Promise<Response>\n  errorHandler: (error: Response) => Response | void\n  responseHandler: (response: Response) => Response\n}\n\ntype Optional<T> = { [key in keyof T]?: T[key] };\n\n/**\n * Default fetch handler\n *\n * @export\n * @param {string} url\n * @param {RequestInit} [options]\n * @returns {Promise<Response>}\n */\nexport async function defaultFetch(url: string, options?: RequestInit): Promise<Response> {\n  return await new Response(JSON.stringify({ error: 'Response via default fetch handler', to: url, options }), { status: 200 });\n}\n\n/**\n * Generic API client with default request\n *\n * @export\n * @class GenericAPIClient\n */\nexport class GenericAPIClient {\n  public readonly handlers: APIClientHandlers;\n  constructor(\n    public readonly baseURL: string = '',\n    public readonly clientConfig?: RequestInit,\n    handlers?: Optional<APIClientHandlers>\n  ) {\n    const defaultHandlers: APIClientHandlers = {\n      fetchHandler: window.fetch || defaultFetch,\n      errorHandler(resp) {\n        throw new ResponseException(handleStatus(resp.status), resp.status, resp);\n      },\n      responseHandler: resp => resp\n    }\n    this.handlers = handlers ? { ...defaultHandlers, ...handlers } : defaultHandlers;\n  }\n\n  /**\n   * Request method for making requests (duh)\n   *\n   * @param {string} url Url to make request\n   * @param {RequestInit} [fetchConfig] Default fetch config\n   * @param {boolean} [overrideDefaultConfig] Should override client base fetch config or not\n   * @returns {(Promise<Response | any>)}\n   * @memberof GenericAPIClient\n   */\n  public async request(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<Response | any> {\n    if (!url.match(/^(\\w+:)?\\/\\//)) {\n      url = this.baseURL ? new URL(url, this.baseURL).href : url;\n    }\n    try {\n      let response = this.handlers.responseHandler(await this.handlers.fetchHandler(url, overrideDefaultConfig ? fetchConfig : { ...this.clientConfig, ...fetchConfig }));\n      if (!response.ok) {\n        return this.handlers.errorHandler(response) || response;\n      }\n      return response;\n    } catch (e) {\n      throw e;\n    }\n  }\n\n  /**\n   * Fast alias method for request\n   *\n   * @private\n   * @param {string} method HTTP method (GET, PUT, POST, etc)\n   * @param {string} url Url to make request\n   * @param {RequestInit} [fetchConfig] Default fetch config\n   * @param {boolean} [overrideDefaultConfig] Should override client base fetch config or not\n   * @returns {(Promise<Response | any>)}\n   * @memberof GenericAPIClient\n   */\n  private async alias(method: string, url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<Response | any> {\n    fetchConfig = fetchConfig || {};\n    fetchConfig.method = method;\n    return await this.request(url, fetchConfig, overrideDefaultConfig);\n  }\n\n  public async get(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<Response | any> {\n    return await this.alias('get', url, fetchConfig, overrideDefaultConfig);\n  }\n\n  public async put(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<Response | any> {\n    return await this.alias('put', url, fetchConfig, overrideDefaultConfig);\n  }\n\n  public async post(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<Response | any> {\n    return await this.alias('post', url, fetchConfig, overrideDefaultConfig);\n  }\n\n  public async patch(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<Response | any> {\n    return await this.alias('patch', url, fetchConfig, overrideDefaultConfig);\n  }\n\n  public async delete(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<Response | any> {\n    return await this.alias('delete', url, fetchConfig, overrideDefaultConfig);\n  }\n}\n\nexport class ResponseException extends Error {\n  constructor(\n    message: string,\n    public status: ResponseErrors,\n    public data?: Response\n  ) {\n    super(message)/* istanbul ignore next: I DON'T KNOW WHY!!!!! */;\n    Object.setPrototypeOf(this, ResponseException.prototype);\n    this.name = 'ResponseExcpetion';\n  }\n\n  toString() {\n    return this.name + ': ' + this.message;\n  }\n}\n\n/**\n * Retrieve string from response status\n *\n * @export\n * @param {number} [status=-1] Response status (200, 404, 500, etc)\n * @returns {string}\n */\nexport function handleStatus(status: number = -1): string {\n  return ResponseErrors[status] || ResponseErrors[-1];\n}\n\nexport enum ResponseErrors {\n  BadRequest = 400,\n  Unauthorized = 401,\n  PaymentRequired = 402,\n  Forbidden = 403,\n  NotFound = 404,\n  MethodNotAllowed = 405,\n  NotAcceptable = 406,\n  ProxyAuthenticationRequired = 407,\n  RequestTimeout = 408,\n  Conflict = 409,\n  Gone = 410,\n  LengthRequired = 411,\n  InvalidMedia = 415,\n  'I\\'m a teapot' = 418,\n  Unprocessable = 422,\n  TooManyRequests = 429,\n  ServerError = 500,\n  NotImplemented = 501,\n  BadGateway = 502,\n  ServiceUnavailable = 503,\n  GatewayTimeout = 504,\n  UnknownError = -1\n}\n","import { GenericAPIClient } from './generic-client';\n\nexport * from './generic-client';\n\nexport class JsonAPIClient extends GenericAPIClient {\n  public async request(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<any> {\n    return await (await super.request(url, fetchConfig, overrideDefaultConfig)).json();\n  }\n}\n\nexport class TextAPIClient extends GenericAPIClient {\n  public async request(url: string, fetchConfig?: RequestInit, overrideDefaultConfig?: boolean): Promise<string> {\n    return await (await super.request(url, fetchConfig, overrideDefaultConfig)).text();\n  }\n}\n"],"names":["tslib_1.__extends"],"mappings":"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"}